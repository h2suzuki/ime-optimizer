# IME Optimizer Chrome Extension 要件定義書

## 1. 概要

### 1.1 目的
多くのWebサイトで日本語入力のIME制御が適切に設定されていない問題を解決する。入力フィールドのtype属性とinputmode属性を自動的に最適化し、ユーザーの入力体験を向上させる。

### 1.2 解決する課題
- アルファベット専用フィールドでIMEがONになっている
- 電話番号フィールドでIMEがONになっている
- 日本語入力フィールドでIMEがOFFになっている
- type属性とinputmode属性が適切に設定されていない

## 2. 機能要件

### 2.1 コア機能
1. **自動属性推測機能**
   - 入力フィールドの名称（label、placeholder、name属性など）から適切なtype/inputmode属性を推測
   - 詳細な推測ロジックは `docs/input-attributes-research.md` を参照
   - 絵文字アイコンによる視覚的な表示：
     - 📝 日本語入力（氏名、住所等）
     - 📧 メールアドレス
     - 📞 電話番号
     - 🔢 数値入力
     - 💳 クレジットカード
     - 🔒 パスワード
     - 📅 日付
     - 🔍 検索
     - 🔗 URL

2. **日本語サイト自動検出**
   - ページの言語設定（lang属性）を確認
   - コンテンツの文字種別分析（日本語文字の割合）
   - デフォルトで日本語サイトのみで有効化
   - 手動で他言語サイトでも有効化可能

3. **属性オーバーライド機能**
   - 推測された属性を手動で変更可能
   - フィールドごとに個別設定可能
   - オーバーライドの有効/無効切り替え

4. **サイト別設定**
   - 拡張機能の有効/無効をドメイン単位で管理
   - ホワイトリスト/ブラックリスト方式
   - サイトごとのデフォルトIMEモード設定：
     - 推測できなかったフィールドのIME状態（ON/OFF）を選択可能
     - 例：技術系サイトではデフォルトOFF、一般的なサイトではデフォルトON

### 2.2 UI機能
1. **フィールドインジケーター**
   - 各入力フィールドの右端に絵文字アイコンを表示
   - 現在の属性設定を視覚的に表示（上記の絵文字を使用）
   - オーバーライド状態の表示：
     - アクティブ: 絵文字が鮮明に表示
     - 非アクティブ: 絵文字が半透明（opacity: 0.5）
   - ホバー時にツールチップで現在の設定を表示

2. **設定ポップアップ**
   - アイコンクリックで表示
   - type属性の変更
   - inputmode属性の変更
   - オーバーライドの有効/無効切り替え

3. **拡張機能ポップアップ**
   - 現在のサイトでの有効/無効切り替え
   - グローバル設定へのアクセス

### 2.3 データ管理
1. **保存データ**
   - サイト別の有効/無効設定
   - フィールド別のカスタム設定
   - カスタムキーワードと対応する属性設定

2. **データ構造**
   ```json
   {
     "global": {
       "enabled": true,
       "defaultMode": "whitelist",
       "autoEnableJapaneseSites": true
     },
     "sites": {
       "example.com": {
         "enabled": true,
         "defaultImeMode": "off",  // "on" | "off" | "auto"
         "fields": {
           "input[name='email']": {
             "type": "email",
             "inputmode": "email"
           }
         }
       }
     },
     "keywords": {
       "メール": { "type": "email", "inputmode": "email" },
       "電話": { "type": "tel", "inputmode": "tel" }
     }
   }
   ```

## 3. 非機能要件

### 3.1 パフォーマンス
- ページ読み込みへの影響を最小限に
- 動的に追加される入力フィールドにも対応

### 3.2 互換性
- Chrome/Edge の最新版に対応
- Manifest V3 準拠

### 3.3 セキュリティ
- 最小限の権限で動作
- ユーザーデータは暗号化せずローカル保存（機密情報を扱わないため）

## 4. 技術仕様

### 4.1 アーキテクチャ
- **Content Script**: 入力フィールドの検出と属性の適用
- **Background Service Worker**: サイト設定の管理
- **Popup**: ユーザーインターフェース
- **Options Page**: 詳細設定画面

### 4.2 使用技術
- TypeScript
- Jest（テスト）
- Webpack（ビルド）

## 5. テスト要件

### 5.1 単体テスト
- 属性推測ロジックのテスト
- データ管理機能のテスト
- UI コンポーネントのテスト

### 5.2 統合テスト
- Content Script と Background の連携
- 実際のWebページでの動作確認

### 5.3 E2Eテスト
- ユーザーシナリオに基づく動作確認

## 6. 開発方針
- Test-Driven Development (TDD) の採用
- 段階的な機能実装
- コードレビューとリファクタリングの重視

## 7. 今後の拡張可能性
- 機械学習による推測精度の向上
- 多言語対応
- フォームバリデーションの支援