name: Release

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  release:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm test
      
      - name: Type check
        run: npm run type-check
      
      - name: Build extension
        run: npm run build
      
      - name: Create extension package
        run: npm run package
        
      - name: Extract version from tag
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT
      
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: IME Optimizer v${{ steps.version.outputs.VERSION }}
          body: |
            ## ğŸ‰ IME Optimizer v${{ steps.version.outputs.VERSION }}
            
            Chromeæ‹¡å¼µæ©Ÿèƒ½ã€ŒIME Optimizerã€ã®æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚
            
            ### ğŸ“¥ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
            1. `ime-optimizer-v${{ steps.version.outputs.VERSION }}.zip` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            2. ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡
            3. Chromeã®æ‹¡å¼µæ©Ÿèƒ½ç®¡ç†ç”»é¢ã‚’é–‹ã
            4. ã€Œãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã€ã‚’æœ‰åŠ¹ã«ã™ã‚‹
            5. ã€Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã•ã‚Œã¦ã„ãªã„æ‹¡å¼µæ©Ÿèƒ½ã‚’èª­ã¿è¾¼ã‚€ã€ã§è§£å‡ã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ
            
            ### âœ¨ ä¸»ãªæ©Ÿèƒ½
            - ğŸ¤– AIæ¨æ¸¬ã«ã‚ˆã‚‹å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å±æ€§ã®æœ€é©åŒ–
            - ğŸŒ æ—¥æœ¬èªã‚µã‚¤ãƒˆã®è‡ªå‹•æ¤œå‡º
            - âš™ï¸ ã‚µã‚¤ãƒˆåˆ¥ãƒ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åˆ¥ã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®š
            - ğŸ“± çµµæ–‡å­—ã‚¢ã‚¤ã‚³ãƒ³ã«ã‚ˆã‚‹è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            
            ### ğŸ”§ æŠ€è¡“ä»•æ§˜
            - Chrome Extension Manifest V3
            - TypeScript + Jest (50ãƒ†ã‚¹ãƒˆé€šé)
            - ESLint (ã‚³ãƒ¼ãƒ‰å“è³ªä¿è¨¼)
            
            ---
            ğŸ¤– Generated with GitHub Actions
          files: |
            ime-optimizer-v${{ steps.version.outputs.VERSION }}.zip
          draft: false
          prerelease: false